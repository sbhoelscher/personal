<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>8-Week Polarized Cycling & Strength Plan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* Workout Flow Styles */
        .workout-container {
            position: relative;
            overflow: hidden;
            min-height: 500px;
        }

        .workout-card {
            background: white;
            border-radius: 20px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            position: relative;
            touch-action: pan-y;
            transition: transform 0.3s ease;
        }

        .workout-card.swiping {
            transition: none;
        }

        .workout-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px 20px 0 0;
            text-align: center;
        }

        .workout-progress {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .workout-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .workout-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .workout-body {
            padding: 40px 30px;
            text-align: center;
        }

        .exercise-description {
            color: #666;
            font-size: 16px;
            line-height: 1.8;
            margin: 20px 0;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .exercise-notes {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            color: #856404;
            font-size: 14px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }

        .set-display {
            font-size: 120px;
            font-weight: 800;
            color: #667eea;
            margin: 30px 0;
            line-height: 1;
        }

        .plank-timer {
            font-size: 96px;
            font-weight: 800;
            color: #667eea;
            margin: 30px 0;
            font-variant-numeric: tabular-nums;
        }

        .rest-display {
            padding: 60px 20px;
        }

        .rest-timer {
            font-size: 96px;
            font-weight: 800;
            color: #667eea;
            margin: 30px 0;
            font-variant-numeric: tabular-nums;
        }

        .rest-message {
            font-size: 24px;
            color: #666;
            margin-bottom: 20px;
        }

        .swipe-hint {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 14px;
            border-top: 1px solid #eee;
        }

        .swipe-hint svg {
            width: 24px;
            height: 24px;
            margin: 0 5px;
            vertical-align: middle;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .completion-card {
            text-align: center;
            padding: 60px 30px;
        }

        .completion-icon {
            font-size: 96px;
            margin-bottom: 20px;
        }

        .completion-title {
            font-size: 36px;
            font-weight: 800;
            color: #28a745;
            margin-bottom: 10px;
        }

        .completion-message {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }

        .week-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .week-btn {
            padding: 10px 20px;
            background: #f0f0f0;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .week-btn:hover {
            background: #e0e0e0;
        }

        .week-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .session-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .session-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .session-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .session-card h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .session-card p {
            opacity: 0.9;
            font-size: 14px;
        }

        .progress-bar-container {
            background: #e9ecef;
            height: 6px;
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .rest-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .rest-preset {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .rest-preset:hover {
            background: #667eea;
            color: white;
        }

        /* Cycling Tab Styles */
        .cycling-schedule {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .workout-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin: 2px;
        }

        .type-act { background: #d4edda; color: #155724; }
        .type-thresh { background: #fff3cd; color: #856404; }
        .type-rec { background: #d1ecf1; color: #0c5460; }
        .type-vo2 { background: #f8d7da; color: #721c24; }
        .type-end { background: #e2e3e5; color: #383d41; }
        .type-rest { background: #f0f0f0; color: #666; }

        .cycling-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .cycling-details h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .cycling-details p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .info-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            header {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .workout-title {
                font-size: 28px;
            }

            .set-display {
                font-size: 80px;
            }

            .rest-timer {
                font-size: 72px;
            }

            .btn {
                padding: 12px 30px;
                font-size: 16px;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>8-Week Polarized Cycling & Strength Plan</h1>
            <p class="subtitle">Hard days hard, easy days easy. Building aerobic base and high-intensity capacity | FTP: 193W | Zone 5: 203-230W</p>
        </header>

        <div class="tabs">
            <button class="tab active" data-tab="strength">Strength Sessions</button>
            <button class="tab" data-tab="cycling">Cycling Schedule</button>
            <button class="tab" data-tab="info">Exercise Guide</button>
        </div>

        <!-- Strength Tab -->
        <div class="tab-content active" id="strength">
            <div class="card">
                <h2>Select Week</h2>
                <div class="week-selector">
                    <button class="week-btn active" data-week="1-2">Weeks 1-2</button>
                    <button class="week-btn" data-week="3-4">Weeks 3-4</button>
                    <button class="week-btn" data-week="5-6">Weeks 5-6</button>
                    <button class="week-btn" data-week="7-8">Weeks 7-8</button>
                </div>
            </div>

            <div class="card" id="sessionSelect">
                <h2>Choose Your Workout</h2>
                <div class="session-selector">
                    <div class="session-card" onclick="startWorkout('morningActivation')">
                        <h3>Morning Activation</h3>
                        <p>Daily • Wake up hips and core</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 exercises • 5 min</p>
                    </div>
                    <div class="session-card" onclick="startWorkout('bandWork')">
                        <h3>Hip & Glute Activation</h3>
                        <p>Before strength • Essential warmup</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 exercises</p>
                    </div>
                    <div class="session-card" onclick="startWorkout('sessionA')">
                        <h3>Session A: Squat & Pull</h3>
                        <p>Wednesday • Squatting patterns & pulling movements</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 exercises</p>
                    </div>
                    <div class="session-card" onclick="startWorkout('sessionB')">
                        <h3>Session B: Hinge & Lunge</h3>
                        <p>Monday • Hip hinge patterns & single-leg work</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 exercises</p>
                    </div>
                    <div class="session-card" onclick="startWorkout('postRideStretching')">
                        <h3>Post-Ride Stretching</h3>
                        <p>After rides • Focus on tight areas</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 stretches • 5-10 min</p>
                    </div>
                    <div class="session-card" onclick="startWorkout('eveningMobility')">
                        <h3>Evening Mobility</h3>
                        <p>Rest days • Foam rolling & deep stretches</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 exercises • 10-15 min</p>
                    </div>
                </div>
            </div>

            <div class="card" id="workoutView" style="display: none;">
                <div class="workout-container">
                    <div class="workout-card" id="workoutCard"></div>
                </div>
            </div>
        </div>

        <!-- Cycling Tab -->
        <div class="tab-content" id="cycling">
            <div class="card">
                <h2>8-Week Cycling Schedule</h2>
                <div class="cycling-schedule">
                    <table id="cyclingTable"></table>
                </div>
            </div>

            <div class="card">
                <h2>Cycling Workout Details</h2>
                <div id="cyclingDetails"></div>
            </div>
        </div>

        <!-- Info Tab -->
        <div class="tab-content" id="info">
            <div class="card">
                <h2>Exercise Descriptions & Form Tips</h2>
                <div id="exerciseInfo"></div>
            </div>
        </div>
    </div>

    <script>
        // Exercise data
        const exercises = {
            sessionA: [
                {
                    name: "Goblet Squat",
                    prescription: {
                        "1-2": "2×8 @ 25lb",
                        "3-4": "2×6 @ 30lb",
                        "5-6": "2×6 @ 35lb",
                        "7-8": "2×5 @ 40lb"
                    },
                    description: "Hold a dumbbell vertically against your chest with both hands. Squat down keeping your chest up and elbows inside your knees. Drive through your heels to stand.",
                    notes: "Heavy. Elbows inside knees. Chest up."
                },
                {
                    name: "Bent-Over Row",
                    prescription: {
                        "1-2": "2×8 @ 25lb each",
                        "3-4": "2×8 @ 30lb each",
                        "5-6": "2×6 @ 30lb each",
                        "7-8": "2×6 @ 35lb each"
                    },
                    description: "Hinge at hips with flat back, dumbbells hanging down. Pull dumbbells to ribcage, driving elbows back. Squeeze shoulder blades together at top.",
                    notes: "Flat back. Pull to hip pocket."
                },
                {
                    name: "Bulgarian Split Squat",
                    prescription: {
                        "1-2": "2×6 each bodyweight",
                        "3-4": "2×6 each bodyweight",
                        "5-6": "2×6 each @ 10lb",
                        "7-8": "2×6 each @ 10lb"
                    },
                    description: "Place rear foot on bench behind you. Lower down on front leg keeping torso upright and front knee tracking over toe. Drive through front heel to return.",
                    notes: "Optional. Skip if knees feel \"creaky.\""
                },
                {
                    name: "Dead Bug",
                    prescription: {
                        "1-2": "2×8 each side",
                        "3-4": "2×8 each side",
                        "5-6": "2×10 each side",
                        "7-8": "2×10 each side"
                    },
                    description: "Lie on back with arms extended up and knees bent at 90°. Lower opposite arm and leg while keeping lower back pressed to floor. Return and repeat other side.",
                    notes: "Keep lower back glued to the floor."
                },
                {
                    name: "Pallof Press",
                    prescription: {
                        "1-2": "2×10 each side",
                        "3-4": "2×10 each side",
                        "5-6": "2×12 each side",
                        "7-8": "2×12 each side"
                    },
                    description: "Stand sideways to anchor point with band at chest height. Hold band at chest, then press straight out resisting rotation. Return to chest.",
                    notes: "Anti-rotation. Resist the band twisting you."
                }
            ],
            sessionB: [
                {
                    name: "Dumbbell Deadlift",
                    prescription: {
                        "1-2": "2×8 @ 30lb each",
                        "3-4": "2×6 @ 35lb each",
                        "5-6": "2×6 @ 40lb each",
                        "7-8": "2×5 @ 45lb each"
                    },
                    description: "Stand with dumbbells at sides. Hinge at hips and bend knees to lower weights toward floor. Keep back flat and chest up. Drive through heels and squeeze glutes at top.",
                    notes: "Heavy. Hinge deep, snap hips forward."
                },
                {
                    name: "Push-Ups",
                    prescription: {
                        "1-2": "2×8",
                        "3-4": "2×10",
                        "5-6": "2×12",
                        "7-8": "2×15"
                    },
                    description: "Start in plank position with hands slightly wider than shoulders. Lower chest to floor keeping body straight. Push back up to starting position.",
                    notes: "Keep core tight. Elevate hands if needed."
                },
                {
                    name: "Reverse Lunge",
                    prescription: {
                        "1-2": "2×6 each bodyweight",
                        "3-4": "2×6 each @ 10lb",
                        "5-6": "2×8 each @ 10lb",
                        "7-8": "2×8 each @ 15lb"
                    },
                    description: "Step backward into lunge position, lowering back knee toward floor. Front knee stays over ankle. Push through front heel to return to standing.",
                    notes: "Stability focus. Slow eccentric (3 sec down)."
                },
                {
                    name: "Glute Bridge",
                    prescription: {
                        "1-2": "2×10 bodyweight",
                        "3-4": "2×10 @ 20lb",
                        "5-6": "2×10 @ 25lb",
                        "7-8": "2×10 @ 30lb"
                    },
                    description: "Lie on back with knees bent and feet flat. Drive through heels to lift hips up, squeezing glutes hard at top. Lower with control.",
                    notes: "Pause at top for 2 sec. Squeeze hard."
                },
                {
                    name: "Plank",
                    prescription: {
                        "1-2": "2×30 sec",
                        "3-4": "2×35 sec",
                        "5-6": "2×40 sec",
                        "7-8": "2×45 sec"
                    },
                    description: "Support body on forearms and toes, maintaining straight line from head to heels. Engage core and avoid sagging hips or raising butt.",
                    notes: "High tension. Squeeze glutes and quads.",
                    isTime: true
                }
            ],
            bandWork: [
                {
                    name: "Clamshells",
                    prescription: {
                        "1-2": "2×15 each side",
                        "3-4": "2×20 each side",
                        "5-6": "3×15 each side",
                        "7-8": "3×15 each side"
                    },
                    description: "Lie on side with band around thighs, knees bent. Keep feet together and open top knee like a clamshell. Control the return.",
                    notes: "Progress band resistance - Essential for hip stabilizer activation"
                },
                {
                    name: "Monster Walks",
                    prescription: {
                        "1-2": "2×20 steps",
                        "3-4": "2×25 steps",
                        "5-6": "3×20 steps",
                        "7-8": "3×20 steps"
                    },
                    description: "Band around thighs, quarter squat position. Take wide diagonal steps forward, maintaining tension on band throughout.",
                    notes: "Stay low - Keep knees bent and tension on the band constant"
                },
                {
                    name: "Lateral Band Walks",
                    prescription: {
                        "1-2": "2×12 each direction",
                        "3-4": "2×15 each direction",
                        "5-6": "2×15 each direction",
                        "7-8": "3×15 each direction"
                    },
                    description: "Band around ankles or thighs, slight squat. Step sideways keeping feet parallel and maintaining band tension.",
                    notes: "Keep tension constant - Don't let feet come together, keep band stretched"
                },
                {
                    name: "Banded Hip Flexion",
                    prescription: {
                        "1-2": "2×10 each leg",
                        "3-4": "2×12 each leg",
                        "5-6": "2×12 each leg",
                        "7-8": "3×12 each leg"
                    },
                    description: "Standing with band around ankle attached to anchor behind you. Drive knee up toward chest against band resistance.",
                    notes: "Standing, knee to chest - Important for hip flexor strength and cycling"
                },
                {
                    name: "Fire Hydrants",
                    prescription: {
                        "1-2": "2×10 each side",
                        "3-4": "2×12 each side",
                        "5-6": "2×12 each side",
                        "7-8": "2×15 each side"
                    },
                    description: "On hands and knees with band around thighs. Keeping knee bent at 90°, lift leg out to side like a dog at a hydrant. Lower with control.",
                    notes: "Control at top - Pause at the top to really feel glute medius working"
                }
            ],
            morningActivation: [
                {
                    name: "Cat-Cow Stretches",
                    prescription: {
                        "1-2": "1×10 reps",
                        "3-4": "1×10 reps",
                        "5-6": "1×10 reps",
                        "7-8": "1×10 reps"
                    },
                    description: "Start on hands and knees. Arch back and look up (cow), then round spine and tuck chin (cat). Flow smoothly between positions.",
                    notes: "Wake up your spine - Move slowly and breathe deeply"
                },
                {
                    name: "World's Greatest Stretch",
                    prescription: {
                        "1-2": "1×5 each side",
                        "3-4": "1×5 each side",
                        "5-6": "1×5 each side",
                        "7-8": "1×5 each side"
                    },
                    description: "Lunge position with back leg straight. Place hand inside front foot, rotate torso and reach other arm up toward ceiling. Return and repeat.",
                    notes: "Hip mobility and thoracic rotation - Hold each rotation for 2-3 seconds"
                },
                {
                    name: "Glute Bridges",
                    prescription: {
                        "1-2": "1×10 reps",
                        "3-4": "1×10 reps",
                        "5-6": "1×10 reps",
                        "7-8": "1×10 reps"
                    },
                    description: "Lie on back with knees bent. Drive through heels to lift hips, squeeze glutes at top, lower with control.",
                    notes: "Activate glutes - Squeeze hard at the top"
                },
                {
                    name: "Bird-Dogs",
                    prescription: {
                        "1-2": "1×8 each side",
                        "3-4": "1×8 each side",
                        "5-6": "1×8 each side",
                        "7-8": "1×8 each side"
                    },
                    description: "On hands and knees, extend opposite arm and leg. Keep hips level and core tight. Return and alternate sides.",
                    notes: "Core stability - Move slowly and maintain balance"
                },
                {
                    name: "Standing Hip Flexor Raises",
                    prescription: {
                        "1-2": "1×10 each side",
                        "3-4": "1×10 each side",
                        "5-6": "1×10 each side",
                        "7-8": "1×10 each side"
                    },
                    description: "Stand tall, drive one knee up toward chest. Lower with control and repeat. Keep core engaged and avoid leaning back.",
                    notes: "Hip flexor activation - Important for cycling"
                }
            ],
            postRideStretching: [
                {
                    name: "Hip Flexor Stretch",
                    prescription: {
                        "1-2": "1×30-60 sec each",
                        "3-4": "1×30-60 sec each",
                        "5-6": "1×30-60 sec each",
                        "7-8": "1×30-60 sec each"
                    },
                    description: "Kneeling lunge position with back knee on ground. Push hips forward gently until you feel stretch in front of back hip. Keep torso upright.",
                    notes: "Essential for cyclists - Hip flexors get tight from riding",
                    isTime: true,
                    defaultTime: 45
                },
                {
                    name: "Pigeon Pose / Figure-4 Stretch",
                    prescription: {
                        "1-2": "1×30-60 sec each",
                        "3-4": "1×30-60 sec each",
                        "5-6": "1×30-60 sec each",
                        "7-8": "1×30-60 sec each"
                    },
                    description: "Lying on back, cross one ankle over opposite knee. Pull bottom leg toward chest until you feel stretch in hip/glute of crossed leg.",
                    notes: "Glute and hip stretch - Breathe deeply and relax into it",
                    isTime: true,
                    defaultTime: 45
                },
                {
                    name: "Quad Stretch",
                    prescription: {
                        "1-2": "1×30 sec each",
                        "3-4": "1×30 sec each",
                        "5-6": "1×30 sec each",
                        "7-8": "1×30 sec each"
                    },
                    description: "Standing, bend one knee and pull foot toward glutes. Keep knees together and push hips forward slightly. Hold onto something for balance.",
                    notes: "Front of thigh - Don't arch your back",
                    isTime: true,
                    defaultTime: 30
                },
                {
                    name: "Hamstring Stretch",
                    prescription: {
                        "1-2": "1×30 sec each",
                        "3-4": "1×30 sec each",
                        "5-6": "1×30 sec each",
                        "7-8": "1×30 sec each"
                    },
                    description: "Place one heel on low step or bench. Keep leg straight and hinge at hips, reaching toward toes. Keep back flat.",
                    notes: "Back of thigh - Feel stretch behind knee",
                    isTime: true,
                    defaultTime: 30
                },
                {
                    name: "Chest Opener / Doorway Stretch",
                    prescription: {
                        "1-2": "1×30 sec",
                        "3-4": "1×30 sec",
                        "5-6": "1×30 sec",
                        "7-8": "1×30 sec"
                    },
                    description: "Stand in doorway with forearms on frame. Step forward gently until you feel stretch across chest. Keep shoulders down.",
                    notes: "Counteracts aero position - Opens up chest and shoulders",
                    isTime: true,
                    defaultTime: 30
                }
            ],
            eveningMobility: [
                {
                    name: "Foam Rolling - Quads",
                    prescription: {
                        "1-2": "1×60-120 sec",
                        "3-4": "1×60-120 sec",
                        "5-6": "1×60-120 sec",
                        "7-8": "1×60-120 sec"
                    },
                    description: "Lie face down with foam roller under your thighs. Roll slowly from hip to just above knee, pausing on tender spots.",
                    notes: "1-2 min per area - Move slowly, breathe through tender spots",
                    isTime: true,
                    defaultTime: 90
                },
                {
                    name: "Foam Rolling - IT Band & Glutes",
                    prescription: {
                        "1-2": "1×60-120 sec each",
                        "3-4": "1×60-120 sec each",
                        "5-6": "1×60-120 sec each",
                        "7-8": "1×60-120 sec each"
                    },
                    description: "Lie on your side with roller under outer thigh. Roll from hip to knee. Then sit on roller for glutes, crossing one ankle over opposite knee.",
                    notes: "Important for IT band health - Don't roll directly on the knee",
                    isTime: true,
                    defaultTime: 90
                },
                {
                    name: "Foam Rolling - Upper Back",
                    prescription: {
                        "1-2": "1×60-120 sec",
                        "3-4": "1×60-120 sec",
                        "5-6": "1×60-120 sec",
                        "7-8": "1×60-120 sec"
                    },
                    description: "Lie on back with roller under upper back. Support head with hands. Roll from mid-back to shoulders, arching over roller.",
                    notes: "Great for cycling posture - Opens up thoracic spine",
                    isTime: true,
                    defaultTime: 90
                },
                {
                    name: "90/90 Hip Stretch",
                    prescription: {
                        "1-2": "1×60 sec each",
                        "3-4": "1×60 sec each",
                        "5-6": "1×60 sec each",
                        "7-8": "1×60 sec each"
                    },
                    description: "Sit with one leg bent 90° in front, other leg bent 90° to the side. Sit tall and lean forward slightly over front shin. Switch sides.",
                    notes: "Deep hip opener - Keep both sit bones grounded",
                    isTime: true,
                    defaultTime: 60
                },
                {
                    name: "Thoracic Spine Rotations",
                    prescription: {
                        "1-2": "1×10 each side",
                        "3-4": "1×10 each side",
                        "5-6": "1×10 each side",
                        "7-8": "1×10 each side"
                    },
                    description: "On hands and knees, place one hand behind head. Rotate torso to bring elbow toward opposite arm, then rotate up toward ceiling. Repeat other side.",
                    notes: "Counteracts cycling position - Move slowly and breathe"
                }
            ]
        };

        // Cycling schedule data - Polarized Plan
        // Day structure: Mon=Z2, Tue=AM Thresh + PM Strength A, Wed=Z2, Thu=AM VO2 + PM Strength B, Fri=Rest, Sat=Long, Sun=Rest/Z2
        const cyclingSchedule = [
            { week: 1, mon: "Z2 30", tue: "Thresh 35", wed: "Z2 30", thu: "VO2 30", fri: "Rest", sat: "Long 100", sun: "Rest/Z2 30", total: "4:15-4:45" },
            { week: 2, mon: "Z2 30", tue: "Thresh 35", wed: "Z2 30", thu: "VO2 30", fri: "Rest", sat: "Long 105", sun: "Rest/Z2 30", total: "4:20-4:50" },
            { week: 3, mon: "Z2 40", tue: "Thresh 40", wed: "Z2 40", thu: "VO2 35", fri: "Rest", sat: "Long 115", sun: "Rest/Z2 35", total: "4:50-5:25" },
            { week: 4, mon: "Z2 35", tue: "Thresh 30", wed: "Z2 35", thu: "VO2 25", fri: "Rest", sat: "Long 100", sun: "Rest", total: "4:05", note: "Mini-deload" },
            { week: 5, mon: "Z2 45", tue: "Thresh 40", wed: "Z2 45", thu: "VO2 40", fri: "Rest", sat: "Long 120", sun: "Rest/Z2 40", total: "5:30-6:10" },
            { week: 6, mon: "Z2 50", tue: "Thresh 45", wed: "Z2 50", thu: "VO2 40", fri: "Rest", sat: "Long 130", sun: "Rest/Z2 40", total: "5:55-6:35" },
            { week: 7, mon: "Z2 55", tue: "Thresh 45", wed: "Z2 55", thu: "VO2 45", fri: "Rest", sat: "Long 150", sun: "Rest/Z2 45", total: "6:30-7:15" },
            { week: 8, mon: "Z2 30", tue: "Thresh 25", wed: "Z2 30", thu: "Rest", fri: "Rest", sat: "Test Ride", sun: "Rest", total: "~4:00", note: "Deload" }
        ];

        const cyclingDetails = {
            "Zone 2 Sessions": "True aerobic endurance. Conversational pace, nose-breathing possible. Heart rate typically 60-70% max. The goal is accumulating time at this intensity to build mitochondrial density and fat oxidation. Don't drift up into Zone 3—if you can't hold a conversation, back off.",
            "Threshold Sessions (Zone 4)": {
                "Overview": "Lactate threshold work. Should feel 'comfortably hard'—sustainable but demanding.",
                "Weeks 1-2": "3×(3-4-3) min Z3-Z4-Z3 with 3 min rest between sets",
                "Weeks 3-4": "2×10 min Z4 with 5 min recovery, or 3×8 min Z4 (Week 4: reduce to 2×8 min)",
                "Weeks 5-6": "2×12 min Z4 or 3×10 min Z4",
                "Week 7": "2×15 min Z4 or 1×20 min Z4 (peak)"
            },
            "VO2 Max Sessions (Zone 5)": {
                "Target": "203-230W at high cadence 95-105 RPM to reduce knee stress",
                "Weeks 1-2": "4×3 min Z5 with 3 min easy recovery",
                "Weeks 3-4": "5×3 min Z5 or 4×4 min Z5 (Week 4: reduce to 4×3 min)",
                "Weeks 5-6": "5×4 min Z5 or 4×5 min Z5",
                "Week 7": "5×5 min or 6×4 min Z5 (peak)"
            },
            "Long Rides": "Zone 2, conversational pace. Time in saddle is the goal. As duration increases in weeks 5-7, consider taking these outside for real-world riding practice—hills, wind, traffic awareness. Bring nutrition for rides over 90 min.",
            "Weekly Structure": {
                "Mon": "Zone 2",
                "Tue": "AM: Threshold intervals | PM: Strength A",
                "Wed": "Zone 2",
                "Thu": "AM: VO2 max intervals | PM: Strength B",
                "Fri": "Rest",
                "Sat": "Long ride",
                "Sun": "Rest or optional Zone 2"
            },
            "Monitoring": {
                "RHR trending up": "If resting heart rate rises 5+ bpm for 2-3 days, consider extra rest",
                "HRV dropping": "Consistent HRV suppression suggests incomplete recovery",
                "VO2 intervals suffering": "If you can't hit target power, fatigue is accumulating",
                "Sunday flexibility": "Use optional Z2 if recovered, skip if you need more rest"
            }
        };

        // Workout state
        let currentWeek = "1-2";
        let currentSession = null;
        let currentExerciseIndex = 0;
        let currentSet = 1;
        let totalSets = 0;
        let isResting = false;
        let restTime = 30; // Default rest time in seconds
        let restTimer = null;
        let restRemaining = 0;
        let touchStartX = 0;
        let touchEndX = 0;
        let plankTimer = null;
        let plankRemaining = 0;
        let wakeLock = null;

        // Initialize app
        function init() {
            setupTabs();
            setupWeekSelector();
            renderCyclingSchedule();
            renderCyclingDetails();
            renderExerciseInfo();
        }

        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
        }

        function setupWeekSelector() {
            document.querySelectorAll('.week-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.week-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentWeek = btn.dataset.week;
                });
            });
        }

        async function startWorkout(sessionType) {
            currentSession = sessionType;
            currentExerciseIndex = 0;
            currentSet = 1;
            isResting = false;

            // Request wake lock to keep screen on
            await requestWakeLock();

            document.getElementById('sessionSelect').style.display = 'none';
            document.getElementById('workoutView').style.display = 'block';

            renderWorkoutCard();
            setupSwipeGestures();
        }

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake Lock activated');

                    // Re-request wake lock when page becomes visible again
                    document.addEventListener('visibilitychange', async () => {
                        if (wakeLock !== null && document.visibilityState === 'visible') {
                            wakeLock = await navigator.wakeLock.request('screen');
                        }
                    });
                }
            } catch (err) {
                console.log('Wake Lock not supported or failed:', err);
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release()
                    .then(() => {
                        wakeLock = null;
                        console.log('Wake Lock released');
                    });
            }
        }

        function setupSwipeGestures() {
            const card = document.getElementById('workoutCard');

            const handleTouchStart = (e) => {
                touchStartX = e.changedTouches[0].screenX;
            };

            const handleTouchMove = (e) => {
                touchEndX = e.changedTouches[0].screenX;
                const diff = touchEndX - touchStartX;

                if (Math.abs(diff) > 10) {
                    card.classList.add('swiping');
                    card.style.transform = `translateX(${diff}px) rotate(${diff * 0.02}deg)`;
                }
            };

            const handleTouchEnd = () => {
                const diff = touchEndX - touchStartX;
                card.classList.remove('swiping');
                card.style.transform = '';

                if (diff > 100) {
                    // Swiped right - go to rest
                    completeSet();
                } else if (diff < -100) {
                    // Swiped left - skip rest
                    if (isResting) {
                        skipRest();
                    }
                }
            };

            // Remove existing listeners before adding new ones
            card.removeEventListener('touchstart', handleTouchStart);
            card.removeEventListener('touchmove', handleTouchMove);
            card.removeEventListener('touchend', handleTouchEnd);

            card.addEventListener('touchstart', handleTouchStart);
            card.addEventListener('touchmove', handleTouchMove);
            card.addEventListener('touchend', handleTouchEnd);
        }

        function renderWorkoutCard() {
            const card = document.getElementById('workoutCard');
            const sessionExercises = exercises[currentSession];

            if (currentExerciseIndex >= sessionExercises.length) {
                renderCompletion();
                return;
            }

            const exercise = sessionExercises[currentExerciseIndex];
            const prescription = exercise.prescription[currentWeek];
            const sets = parseInt(prescription.match(/(\d+)×/)?.[1] || 3);
            totalSets = sets;

            const progress = `Exercise ${currentExerciseIndex + 1}/${sessionExercises.length}`;

            if (isResting) {
                card.innerHTML = `
                    <div class="workout-header">
                        <div class="workout-progress">${progress}</div>
                        <div class="workout-title">Rest</div>
                        <div class="workout-subtitle">Recovery between sets</div>
                    </div>
                    <div class="workout-body">
                        <div class="rest-display">
                            <div class="rest-message">Great work! Take a breather</div>
                            <div class="rest-timer" id="restTimerDisplay">${formatTime(restRemaining)}</div>
                            <div class="rest-controls">
                                <button class="rest-preset" onclick="adjustRest(30)">0:30</button>
                                <button class="rest-preset" onclick="adjustRest(60)">1:00</button>
                                <button class="rest-preset" onclick="adjustRest(90)">1:30</button>
                                <button class="rest-preset" onclick="adjustRest(120)">2:00</button>
                                <button class="rest-preset" onclick="adjustRest(180)">3:00</button>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-secondary" onclick="skipRest()">Skip Rest</button>
                            </div>
                        </div>
                    </div>
                    <div class="swipe-hint">
                        ← Swipe left to skip rest
                    </div>
                `;
                startRestTimer();
            } else if (exercise.isTime) {
                // Plank/stretch with timer
                const timeInSeconds = exercise.defaultTime || parseInt(prescription.match(/(\d+)\s*sec/)?.[1] || 30);
                card.innerHTML = `
                    <div class="workout-header">
                        <div class="workout-progress">${progress} • Set ${currentSet}/${totalSets}</div>
                        <div class="workout-title">${exercise.name}</div>
                        <div class="workout-subtitle">${prescription}</div>
                    </div>
                    <div class="workout-body">
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${(currentSet / totalSets) * 100}%"></div>
                        </div>
                        <div class="plank-timer" id="plankTimerDisplay">${formatTime(timeInSeconds)}</div>
                        <div class="exercise-description">${exercise.description}</div>
                        <div class="exercise-notes">${exercise.notes}</div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="startPlankBtn" onclick="startPlankTimer(${timeInSeconds})">Start Timer</button>
                            <button class="btn btn-secondary" onclick="completeSet()" style="display: none;" id="plankCompleteBtn">Complete Set</button>
                        </div>
                    </div>
                    <div class="swipe-hint">
                        Swipe right after completing hold →
                    </div>
                `;
            } else {
                card.innerHTML = `
                    <div class="workout-header">
                        <div class="workout-progress">${progress} • Set ${currentSet}/${totalSets}</div>
                        <div class="workout-title">${exercise.name}</div>
                        <div class="workout-subtitle">${prescription}</div>
                    </div>
                    <div class="workout-body">
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${(currentSet / totalSets) * 100}%"></div>
                        </div>
                        <div class="set-display">Set ${currentSet}</div>
                        <div class="exercise-description">${exercise.description}</div>
                        <div class="exercise-notes">${exercise.notes}</div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="completeSet()">Complete Set</button>
                        </div>
                    </div>
                    <div class="swipe-hint">
                        Swipe right to complete set →
                    </div>
                `;
            }
        }

        function completeSet() {
            // Clear any existing timers first
            clearAllTimers();

            if (currentSet < totalSets) {
                currentSet++;
                isResting = true;
                restRemaining = restTime;
                renderWorkoutCard();
            } else {
                // Move to next exercise
                currentExerciseIndex++;
                currentSet = 1;
                isResting = false;
                renderWorkoutCard();
            }
        }

        function clearAllTimers() {
            if (plankTimer) {
                clearInterval(plankTimer);
                plankTimer = null;
            }
            if (restTimer) {
                clearInterval(restTimer);
                restTimer = null;
            }
        }

        function startRestTimer() {
            // Always clear any existing timer first
            if (restTimer) {
                clearInterval(restTimer);
                restTimer = null;
            }

            // Store initial value to prevent any stale closure issues
            let timeRemaining = restRemaining;

            restTimer = setInterval(() => {
                timeRemaining--;
                restRemaining = timeRemaining;

                const display = document.getElementById('restTimerDisplay');
                if (display) {
                    display.textContent = formatTime(timeRemaining);
                }

                if (timeRemaining <= 0) {
                    clearInterval(restTimer);
                    restTimer = null;
                    playWhistle();
                    // Timer complete - show "Ready!" but NEVER auto-advance
                    // User must tap Skip Rest or swipe to proceed
                    if (display) {
                        display.textContent = "Ready!";
                    }
                }
            }, 1000);
        }

        function startPlankTimer(duration) {
            // Clear any existing timer
            if (plankTimer) {
                clearInterval(plankTimer);
                plankTimer = null;
            }

            let timeRemaining = duration;
            plankRemaining = duration;

            const startBtn = document.getElementById('startPlankBtn');
            if (startBtn) startBtn.style.display = 'none';

            plankTimer = setInterval(() => {
                timeRemaining--;
                plankRemaining = timeRemaining;

                const display = document.getElementById('plankTimerDisplay');
                if (display) {
                    display.textContent = formatTime(timeRemaining);
                }

                if (timeRemaining <= 0) {
                    clearInterval(plankTimer);
                    plankTimer = null;
                    playWhistle();
                    const completeBtn = document.getElementById('plankCompleteBtn');
                    if (completeBtn) completeBtn.style.display = 'inline-block';
                }
            }, 1000);
        }

        function skipRest() {
            clearAllTimers();
            isResting = false;
            renderWorkoutCard();
        }

        function adjustRest(seconds) {
            // Clear existing timer
            if (restTimer) {
                clearInterval(restTimer);
                restTimer = null;
            }

            restRemaining = seconds;
            restTime = seconds; // Update default for next rest period

            const display = document.getElementById('restTimerDisplay');
            if (display) {
                display.textContent = formatTime(restRemaining);
            }

            // Restart the timer with the new duration
            startRestTimer();
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function renderCompletion() {
            const card = document.getElementById('workoutCard');
            const sessionNames = {
                'morningActivation': 'Morning Activation',
                'bandWork': 'Hip & Glute Activation',
                'sessionA': 'Session A: Squat & Pull',
                'sessionB': 'Session B: Hinge & Lunge',
                'postRideStretching': 'Post-Ride Stretching',
                'eveningMobility': 'Evening Mobility'
            };

            card.innerHTML = `
                <div class="completion-card">
                    <div class="completion-icon">🎉</div>
                    <div class="completion-title">Workout Complete!</div>
                    <div class="completion-message">Great job finishing ${sessionNames[currentSession]}</div>
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="endWorkout()">Done</button>
                        <button class="btn btn-secondary" onclick="restartWorkout()">Do Another</button>
                    </div>
                </div>
            `;
        }

        function endWorkout() {
            releaseWakeLock();
            clearAllTimers();
            document.getElementById('sessionSelect').style.display = 'block';
            document.getElementById('workoutView').style.display = 'none';
        }

        function restartWorkout() {
            releaseWakeLock();
            clearAllTimers();
            document.getElementById('sessionSelect').style.display = 'block';
            document.getElementById('workoutView').style.display = 'none';
        }

        function playWhistle() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();

            // Create a whistle sound (two-tone)
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // First tone
            oscillator1.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator1.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);

            // Second tone (slight harmony)
            oscillator2.frequency.setValueAtTime(1000, audioContext.currentTime);
            oscillator2.frequency.exponentialRampToValueAtTime(1400, audioContext.currentTime + 0.1);

            oscillator1.type = 'sine';
            oscillator2.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

            oscillator1.start(audioContext.currentTime);
            oscillator2.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + 0.2);
            oscillator2.stop(audioContext.currentTime + 0.2);
        }

        function renderCyclingSchedule() {
            const table = document.getElementById('cyclingTable');
            let html = `
                <thead>
                    <tr>
                        <th>Week</th>
                        <th>Mon</th>
                        <th>Tue</th>
                        <th>Wed</th>
                        <th>Thu</th>
                        <th>Fri</th>
                        <th>Sat</th>
                        <th>Sun</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
            `;

            cyclingSchedule.forEach(week => {
                html += `<tr>
                    <td><strong>Week ${week.week}</strong></td>
                    <td>${formatWorkout(week.mon)}</td>
                    <td>${formatWorkout(week.tue)}</td>
                    <td>${formatWorkout(week.wed)}</td>
                    <td>${formatWorkout(week.thu)}</td>
                    <td>${formatWorkout(week.fri)}</td>
                    <td>${formatWorkout(week.sat)}</td>
                    <td>${formatWorkout(week.sun)}</td>
                    <td><strong>${week.total}</strong></td>
                </tr>`;
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        function formatWorkout(workout) {
            if (workout === "Rest") return '<span class="workout-type type-rest">Rest</span>';
            if (workout === "Test Ride") return '<span class="workout-type type-end">Test Ride</span>';
            if (workout.startsWith("Rest/")) return `<span class="workout-type type-rest">${workout}</span>`;

            const type = workout.split(' ')[0].toLowerCase();
            let typeClass = 'type-act';
            if (type === 'thresh') typeClass = 'type-thresh';
            else if (type === 'vo2') typeClass = 'type-vo2';
            else if (type === 'long') typeClass = 'type-end';
            else if (type === 'z2') typeClass = 'type-rec';
            else if (type === 'end') typeClass = 'type-end';
            else if (type === 'rec') typeClass = 'type-rec';

            return `<span class="workout-type ${typeClass}">${workout}</span>`;
        }

        function renderCyclingDetails() {
            const container = document.getElementById('cyclingDetails');
            let html = '';

            for (const [title, content] of Object.entries(cyclingDetails)) {
                html += `<div class="cycling-details">`;
                html += `<h4>${title}</h4>`;

                if (typeof content === 'string') {
                    html += `<p>${content}</p>`;
                } else {
                    for (const [key, value] of Object.entries(content)) {
                        html += `<p><strong>${key}:</strong> ${value}</p>`;
                    }
                }

                html += `</div>`;
            }

            container.innerHTML = html;
        }

        function renderExerciseInfo() {
            const container = document.getElementById('exerciseInfo');
            const allExercises = [...exercises.sessionA, ...exercises.sessionB, ...exercises.bandWork];

            let html = '';
            allExercises.forEach(exercise => {
                html += `
                    <div class="info-section">
                        <h3>${exercise.name}</h3>
                        <p><strong>How to perform:</strong> ${exercise.description}</p>
                        <p><strong>Key points:</strong> ${exercise.notes}</p>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
