<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>8-Week Cycling & Strength Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* Workout Flow Styles */
        .workout-container {
            position: relative;
            overflow: hidden;
            min-height: 500px;
        }

        .workout-card {
            background: white;
            border-radius: 20px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            position: relative;
            touch-action: pan-y;
            transition: transform 0.3s ease;
        }

        .workout-card.swiping {
            transition: none;
        }

        .workout-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px 20px 0 0;
            text-align: center;
        }

        .workout-progress {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .workout-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .workout-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .workout-body {
            padding: 40px 30px;
            text-align: center;
        }

        .exercise-description {
            color: #666;
            font-size: 16px;
            line-height: 1.8;
            margin: 20px 0;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .exercise-notes {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            color: #856404;
            font-size: 14px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }

        .set-display {
            font-size: 120px;
            font-weight: 800;
            color: #667eea;
            margin: 30px 0;
            line-height: 1;
        }

        .plank-timer {
            font-size: 96px;
            font-weight: 800;
            color: #667eea;
            margin: 30px 0;
            font-variant-numeric: tabular-nums;
        }

        .rest-display {
            padding: 60px 20px;
        }

        .rest-timer {
            font-size: 96px;
            font-weight: 800;
            color: #667eea;
            margin: 30px 0;
            font-variant-numeric: tabular-nums;
        }

        .rest-message {
            font-size: 24px;
            color: #666;
            margin-bottom: 20px;
        }

        .swipe-hint {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 14px;
            border-top: 1px solid #eee;
        }

        .swipe-hint svg {
            width: 24px;
            height: 24px;
            margin: 0 5px;
            vertical-align: middle;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .completion-card {
            text-align: center;
            padding: 60px 30px;
        }

        .completion-icon {
            font-size: 96px;
            margin-bottom: 20px;
        }

        .completion-title {
            font-size: 36px;
            font-weight: 800;
            color: #28a745;
            margin-bottom: 10px;
        }

        .completion-message {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }

        .week-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .week-btn {
            padding: 10px 20px;
            background: #f0f0f0;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .week-btn:hover {
            background: #e0e0e0;
        }

        .week-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .session-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .session-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .session-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .session-card h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .session-card p {
            opacity: 0.9;
            font-size: 14px;
        }

        .progress-bar-container {
            background: #e9ecef;
            height: 6px;
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .rest-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .rest-preset {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .rest-preset:hover {
            background: #667eea;
            color: white;
        }

        /* Cycling Tab Styles */
        .cycling-schedule {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .workout-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin: 2px;
        }

        .type-act { background: #d4edda; color: #155724; }
        .type-thresh { background: #fff3cd; color: #856404; }
        .type-rec { background: #d1ecf1; color: #0c5460; }
        .type-vo2 { background: #f8d7da; color: #721c24; }
        .type-end { background: #e2e3e5; color: #383d41; }
        .type-rest { background: #f0f0f0; color: #666; }

        .cycling-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .cycling-details h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .cycling-details p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .info-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            header {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .workout-title {
                font-size: 28px;
            }

            .set-display {
                font-size: 80px;
            }

            .rest-timer {
                font-size: 72px;
            }

            .btn {
                padding: 12px 30px;
                font-size: 16px;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>8-Week Cycling & Strength Tracker</h1>
            <p class="subtitle">Building toward Marin rides with threshold fitness and hip stability | FTP: 193W</p>
        </header>

        <div class="tabs">
            <button class="tab active" data-tab="strength">Strength Sessions</button>
            <button class="tab" data-tab="cycling">Cycling Schedule</button>
            <button class="tab" data-tab="info">Exercise Guide</button>
        </div>

        <!-- Strength Tab -->
        <div class="tab-content active" id="strength">
            <div class="card">
                <h2>Select Week</h2>
                <div class="week-selector">
                    <button class="week-btn active" data-week="1-2">Weeks 1-2</button>
                    <button class="week-btn" data-week="3-4">Weeks 3-4</button>
                    <button class="week-btn" data-week="5-6">Weeks 5-6</button>
                    <button class="week-btn" data-week="7-8">Weeks 7-8</button>
                </div>
            </div>

            <div class="card" id="sessionSelect">
                <h2>Choose Your Workout</h2>
                <div class="session-selector">
                    <div class="session-card" onclick="startWorkout('morningActivation')">
                        <h3>Morning Activation</h3>
                        <p>Daily ‚Ä¢ Wake up hips and core</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 exercises ‚Ä¢ 5 min</p>
                    </div>
                    <div class="session-card" onclick="startWorkout('bandWork')">
                        <h3>Hip & Glute Activation</h3>
                        <p>Before strength ‚Ä¢ Essential warmup</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 exercises</p>
                    </div>
                    <div class="session-card" onclick="startWorkout('sessionA')">
                        <h3>Session A: Squat & Pull</h3>
                        <p>Wednesday ‚Ä¢ Squatting patterns & pulling movements</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 exercises</p>
                    </div>
                    <div class="session-card" onclick="startWorkout('sessionB')">
                        <h3>Session B: Hinge & Lunge</h3>
                        <p>Monday ‚Ä¢ Hip hinge patterns & single-leg work</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 exercises</p>
                    </div>
                    <div class="session-card" onclick="startWorkout('postRideStretching')">
                        <h3>Post-Ride Stretching</h3>
                        <p>After rides ‚Ä¢ Focus on tight areas</p>
                        <p style="margin-top: 10px; font-size: 16px; font-weight: 700;">5 stretches ‚Ä¢ 5-10 min</p>
                    </div>
                </div>
            </div>

            <div class="card" id="workoutView" style="display: none;">
                <div class="workout-container">
                    <div class="workout-card" id="workoutCard"></div>
                </div>
            </div>
        </div>

        <!-- Cycling Tab -->
        <div class="tab-content" id="cycling">
            <div class="card">
                <h2>8-Week Cycling Schedule</h2>
                <div class="cycling-schedule">
                    <table id="cyclingTable"></table>
                </div>
            </div>

            <div class="card">
                <h2>Cycling Workout Details</h2>
                <div id="cyclingDetails"></div>
            </div>
        </div>

        <!-- Info Tab -->
        <div class="tab-content" id="info">
            <div class="card">
                <h2>Exercise Descriptions & Form Tips</h2>
                <div id="exerciseInfo"></div>
            </div>
        </div>
    </div>

    <script>
        // Exercise data
        const exercises = {
            sessionA: [
                {
                    name: "Goblet Squat",
                    prescription: {
                        "1-2": "2√ó8 @ 25lb",
                        "3-4": "2√ó6 @ 30lb",
                        "5-6": "2√ó6 @ 35lb",
                        "7-8": "2√ó5 @ 40lb"
                    },
                    description: "Hold a dumbbell vertically against your chest with both hands. Squat down keeping your chest up and elbows inside your knees. Drive through your heels to stand.",
                    notes: "Heavy. Elbows inside knees. Chest up."
                },
                {
                    name: "Bent-Over Row",
                    prescription: {
                        "1-2": "2√ó8 @ 25lb each",
                        "3-4": "2√ó8 @ 30lb each",
                        "5-6": "2√ó6 @ 30lb each",
                        "7-8": "2√ó6 @ 35lb each"
                    },
                    description: "Hinge at hips with flat back, dumbbells hanging down. Pull dumbbells to ribcage, driving elbows back. Squeeze shoulder blades together at top.",
                    notes: "Flat back. Pull to hip pocket."
                },
                {
                    name: "Bulgarian Split Squat",
                    prescription: {
                        "1-2": "2√ó6 each bodyweight",
                        "3-4": "2√ó6 each bodyweight",
                        "5-6": "2√ó6 each @ 10lb",
                        "7-8": "2√ó6 each @ 10lb"
                    },
                    description: "Place rear foot on bench behind you. Lower down on front leg keeping torso upright and front knee tracking over toe. Drive through front heel to return.",
                    notes: "Optional. Skip if knees feel \"creaky.\""
                },
                {
                    name: "Dead Bug",
                    prescription: {
                        "1-2": "2√ó8 each side",
                        "3-4": "2√ó8 each side",
                        "5-6": "2√ó10 each side",
                        "7-8": "2√ó10 each side"
                    },
                    description: "Lie on back with arms extended up and knees bent at 90¬∞. Lower opposite arm and leg while keeping lower back pressed to floor. Return and repeat other side.",
                    notes: "Keep lower back glued to the floor."
                },
                {
                    name: "Pallof Press",
                    prescription: {
                        "1-2": "2√ó10 each side",
                        "3-4": "2√ó10 each side",
                        "5-6": "2√ó12 each side",
                        "7-8": "2√ó12 each side"
                    },
                    description: "Stand sideways to anchor point with band at chest height. Hold band at chest, then press straight out resisting rotation. Return to chest.",
                    notes: "Anti-rotation. Resist the band twisting you."
                }
            ],
            sessionB: [
                {
                    name: "Dumbbell Deadlift",
                    prescription: {
                        "1-2": "2√ó8 @ 30lb each",
                        "3-4": "2√ó6 @ 35lb each",
                        "5-6": "2√ó6 @ 40lb each",
                        "7-8": "2√ó5 @ 45lb each"
                    },
                    description: "Stand with dumbbells at sides. Hinge at hips and bend knees to lower weights toward floor. Keep back flat and chest up. Drive through heels and squeeze glutes at top.",
                    notes: "Heavy. Hinge deep, snap hips forward."
                },
                {
                    name: "Push-Ups",
                    prescription: {
                        "1-2": "2√ó8",
                        "3-4": "2√ó10",
                        "5-6": "2√ó12",
                        "7-8": "2√ó15"
                    },
                    description: "Start in plank position with hands slightly wider than shoulders. Lower chest to floor keeping body straight. Push back up to starting position.",
                    notes: "Keep core tight. Elevate hands if needed."
                },
                {
                    name: "Reverse Lunge",
                    prescription: {
                        "1-2": "2√ó6 each bodyweight",
                        "3-4": "2√ó6 each @ 10lb",
                        "5-6": "2√ó8 each @ 10lb",
                        "7-8": "2√ó8 each @ 15lb"
                    },
                    description: "Step backward into lunge position, lowering back knee toward floor. Front knee stays over ankle. Push through front heel to return to standing.",
                    notes: "Stability focus. Slow eccentric (3 sec down)."
                },
                {
                    name: "Glute Bridge",
                    prescription: {
                        "1-2": "2√ó10 bodyweight",
                        "3-4": "2√ó10 @ 20lb",
                        "5-6": "2√ó10 @ 25lb",
                        "7-8": "2√ó10 @ 30lb"
                    },
                    description: "Lie on back with knees bent and feet flat. Drive through heels to lift hips up, squeezing glutes hard at top. Lower with control.",
                    notes: "Pause at top for 2 sec. Squeeze hard."
                },
                {
                    name: "Plank",
                    prescription: {
                        "1-2": "2√ó30 sec",
                        "3-4": "2√ó35 sec",
                        "5-6": "2√ó40 sec",
                        "7-8": "2√ó45 sec"
                    },
                    description: "Support body on forearms and toes, maintaining straight line from head to heels. Engage core and avoid sagging hips or raising butt.",
                    notes: "High tension. Squeeze glutes and quads.",
                    isTime: true
                }
            ],
            bandWork: [
                {
                    name: "Clamshells",
                    prescription: {
                        "1-2": "2√ó15 each side",
                        "3-4": "2√ó20 each side",
                        "5-6": "3√ó15 each side",
                        "7-8": "3√ó15 each side"
                    },
                    description: "Lie on side with band around thighs, knees bent. Keep feet together and open top knee like a clamshell. Control the return.",
                    notes: "Progress band resistance - Essential for hip stabilizer activation"
                },
                {
                    name: "Monster Walks",
                    prescription: {
                        "1-2": "2√ó20 steps",
                        "3-4": "2√ó25 steps",
                        "5-6": "3√ó20 steps",
                        "7-8": "3√ó20 steps"
                    },
                    description: "Band around thighs, quarter squat position. Take wide diagonal steps forward, maintaining tension on band throughout.",
                    notes: "Stay low - Keep knees bent and tension on the band constant"
                },
                {
                    name: "Lateral Band Walks",
                    prescription: {
                        "1-2": "2√ó12 each direction",
                        "3-4": "2√ó15 each direction",
                        "5-6": "2√ó15 each direction",
                        "7-8": "3√ó15 each direction"
                    },
                    description: "Band around ankles or thighs, slight squat. Step sideways keeping feet parallel and maintaining band tension.",
                    notes: "Keep tension constant - Don't let feet come together, keep band stretched"
                },
                {
                    name: "Banded Hip Flexion",
                    prescription: {
                        "1-2": "2√ó10 each leg",
                        "3-4": "2√ó12 each leg",
                        "5-6": "2√ó12 each leg",
                        "7-8": "3√ó12 each leg"
                    },
                    description: "Standing with band around ankle attached to anchor behind you. Drive knee up toward chest against band resistance.",
                    notes: "Standing, knee to chest - Important for hip flexor strength and cycling"
                },
                {
                    name: "Fire Hydrants",
                    prescription: {
                        "1-2": "2√ó10 each side",
                        "3-4": "2√ó12 each side",
                        "5-6": "2√ó12 each side",
                        "7-8": "2√ó15 each side"
                    },
                    description: "On hands and knees with band around thighs. Keeping knee bent at 90¬∞, lift leg out to side like a dog at a hydrant. Lower with control.",
                    notes: "Control at top - Pause at the top to really feel glute medius working"
                }
            ],
            morningActivation: [
                {
                    name: "Cat-Cow Stretches",
                    prescription: {
                        "1-2": "1√ó10 reps",
                        "3-4": "1√ó10 reps",
                        "5-6": "1√ó10 reps",
                        "7-8": "1√ó10 reps"
                    },
                    description: "Start on hands and knees. Arch back and look up (cow), then round spine and tuck chin (cat). Flow smoothly between positions.",
                    notes: "Wake up your spine - Move slowly and breathe deeply"
                },
                {
                    name: "World's Greatest Stretch",
                    prescription: {
                        "1-2": "1√ó5 each side",
                        "3-4": "1√ó5 each side",
                        "5-6": "1√ó5 each side",
                        "7-8": "1√ó5 each side"
                    },
                    description: "Lunge position with back leg straight. Place hand inside front foot, rotate torso and reach other arm up toward ceiling. Return and repeat.",
                    notes: "Hip mobility and thoracic rotation - Hold each rotation for 2-3 seconds"
                },
                {
                    name: "Glute Bridges",
                    prescription: {
                        "1-2": "1√ó10 reps",
                        "3-4": "1√ó10 reps",
                        "5-6": "1√ó10 reps",
                        "7-8": "1√ó10 reps"
                    },
                    description: "Lie on back with knees bent. Drive through heels to lift hips, squeeze glutes at top, lower with control.",
                    notes: "Activate glutes - Squeeze hard at the top"
                },
                {
                    name: "Bird-Dogs",
                    prescription: {
                        "1-2": "1√ó8 each side",
                        "3-4": "1√ó8 each side",
                        "5-6": "1√ó8 each side",
                        "7-8": "1√ó8 each side"
                    },
                    description: "On hands and knees, extend opposite arm and leg. Keep hips level and core tight. Return and alternate sides.",
                    notes: "Core stability - Move slowly and maintain balance"
                },
                {
                    name: "Standing Hip Flexor Raises",
                    prescription: {
                        "1-2": "1√ó10 each side",
                        "3-4": "1√ó10 each side",
                        "5-6": "1√ó10 each side",
                        "7-8": "1√ó10 each side"
                    },
                    description: "Stand tall, drive one knee up toward chest. Lower with control and repeat. Keep core engaged and avoid leaning back.",
                    notes: "Hip flexor activation - Important for cycling"
                }
            ],
            postRideStretching: [
                {
                    name: "Hip Flexor Stretch",
                    prescription: {
                        "1-2": "1√ó30-60 sec each",
                        "3-4": "1√ó30-60 sec each",
                        "5-6": "1√ó30-60 sec each",
                        "7-8": "1√ó30-60 sec each"
                    },
                    description: "Kneeling lunge position with back knee on ground. Push hips forward gently until you feel stretch in front of back hip. Keep torso upright.",
                    notes: "Essential for cyclists - Hip flexors get tight from riding",
                    isTime: true,
                    defaultTime: 45
                },
                {
                    name: "Pigeon Pose / Figure-4 Stretch",
                    prescription: {
                        "1-2": "1√ó30-60 sec each",
                        "3-4": "1√ó30-60 sec each",
                        "5-6": "1√ó30-60 sec each",
                        "7-8": "1√ó30-60 sec each"
                    },
                    description: "Lying on back, cross one ankle over opposite knee. Pull bottom leg toward chest until you feel stretch in hip/glute of crossed leg.",
                    notes: "Glute and hip stretch - Breathe deeply and relax into it",
                    isTime: true,
                    defaultTime: 45
                },
                {
                    name: "Quad Stretch",
                    prescription: {
                        "1-2": "1√ó30 sec each",
                        "3-4": "1√ó30 sec each",
                        "5-6": "1√ó30 sec each",
                        "7-8": "1√ó30 sec each"
                    },
                    description: "Standing, bend one knee and pull foot toward glutes. Keep knees together and push hips forward slightly. Hold onto something for balance.",
                    notes: "Front of thigh - Don't arch your back",
                    isTime: true,
                    defaultTime: 30
                },
                {
                    name: "Hamstring Stretch",
                    prescription: {
                        "1-2": "1√ó30 sec each",
                        "3-4": "1√ó30 sec each",
                        "5-6": "1√ó30 sec each",
                        "7-8": "1√ó30 sec each"
                    },
                    description: "Place one heel on low step or bench. Keep leg straight and hinge at hips, reaching toward toes. Keep back flat.",
                    notes: "Back of thigh - Feel stretch behind knee",
                    isTime: true,
                    defaultTime: 30
                },
                {
                    name: "Chest Opener / Doorway Stretch",
                    prescription: {
                        "1-2": "1√ó30 sec",
                        "3-4": "1√ó30 sec",
                        "5-6": "1√ó30 sec",
                        "7-8": "1√ó30 sec"
                    },
                    description: "Stand in doorway with forearms on frame. Step forward gently until you feel stretch across chest. Keep shoulders down.",
                    notes: "Counteracts aero position - Opens up chest and shoulders",
                    isTime: true,
                    defaultTime: 30
                }
            ]
        };

        // Cycling schedule data
        const cyclingSchedule = [
            { week: 1, mon: "Act 20", tue: "Thresh 35", wed: "Rec 25", thu: "Rest", fri: "VO2 30", sat: "End 90", sun: "Rec 40", total: "4:00" },
            { week: 2, mon: "Act 20", tue: "Thresh 35", wed: "Rec 25", thu: "Rest", fri: "VO2 30", sat: "End 90", sun: "Rec 40", total: "4:00" },
            { week: 3, mon: "Act 20", tue: "Thresh 35", wed: "Rec 25", thu: "Rest", fri: "VO2 35", sat: "End 95", sun: "Rec 45", total: "4:15" },
            { week: 4, mon: "Act 20", tue: "Thresh 40", wed: "Rec 30", thu: "Rest", fri: "VO2 35", sat: "End 100", sun: "Rec 45", total: "4:30" },
            { week: 5, mon: "Act 25", tue: "Thresh 40", wed: "Rec 30", thu: "Rest", fri: "VO2 40", sat: "End 105", sun: "Rec 45", total: "4:45" },
            { week: 6, mon: "Act 25", tue: "Thresh 45", wed: "Rec 30", thu: "Rest", fri: "VO2 40", sat: "End 110", sun: "Rec 50", total: "5:00" },
            { week: 7, mon: "Act 25", tue: "Thresh 45", wed: "Rec 35", thu: "Rest", fri: "VO2 45", sat: "End 120", sun: "Rec 50", total: "5:20" },
            { week: 8, mon: "Act 20", tue: "Thresh 30", wed: "Rec 20", thu: "Rest", fri: "VO2 25", sat: "Test Ride", sun: "Rest", total: "~4:00" }
        ];

        const cyclingDetails = {
            "Activation Rides": "Mostly Zone 1-2 with 3-4 short bursts (10-15 sec) at high cadence to wake up the legs. Not hard efforts‚Äîjust spin-ups.",
            "Threshold Sessions": {
                "Weeks 1-2": "3√ó(3-4-3) min Z3-Z4-Z3 with 3 min rest between sets",
                "Weeks 3-4": "2√ó10 min Z4 with 5 min recovery, or 3√ó8 min Z4",
                "Weeks 5-6": "2√ó12 min Z4 or 3√ó10 min Z4",
                "Week 7": "2√ó15 min Z4 or 1√ó20 min Z4 (peak)"
            },
            "VO2 Max Sessions": {
                "Target": "203-230W (Zone 5) at high cadence 95-105 RPM to reduce knee stress",
                "Weeks 1-2": "4√ó3 min Z5 with 3 min easy recovery",
                "Weeks 3-4": "5√ó3 min Z5 or 4√ó4 min Z5",
                "Weeks 5-6": "5√ó4 min Z5 or 4√ó5 min Z5",
                "Week 7": "5√ó5 or 6√ó3 or 5√ó4 min Z5 (peak)"
            },
            "Endurance Rides": "Zone 2, conversational pace. Goal is time in the saddle. Consider taking these outside in weeks 6-7 for Sausalito ride practice.",
            "Recovery Rides": "Zone 1-2, very easy. Should feel almost too easy. If they affect Monday freshness, take full rest instead."
        };

        // Workout state
        let currentWeek = "1-2";
        let currentSession = null;
        let currentExerciseIndex = 0;
        let currentSet = 1;
        let totalSets = 0;
        let isResting = false;
        let restTime = 90; // Default rest time in seconds
        let restTimer = null;
        let restRemaining = 0;
        let touchStartX = 0;
        let touchEndX = 0;
        let plankTimer = null;
        let plankRemaining = 0;
        let wakeLock = null;
        let shouldAutoAdvance = true;

        // Initialize app
        function init() {
            setupTabs();
            setupWeekSelector();
            renderCyclingSchedule();
            renderCyclingDetails();
            renderExerciseInfo();
        }

        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
        }

        function setupWeekSelector() {
            document.querySelectorAll('.week-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.week-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentWeek = btn.dataset.week;
                });
            });
        }

        async function startWorkout(sessionType) {
            currentSession = sessionType;
            currentExerciseIndex = 0;
            currentSet = 1;
            isResting = false;

            // Request wake lock to keep screen on
            await requestWakeLock();

            document.getElementById('sessionSelect').style.display = 'none';
            document.getElementById('workoutView').style.display = 'block';

            renderWorkoutCard();
            setupSwipeGestures();
        }

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake Lock activated');

                    // Re-request wake lock when page becomes visible again
                    document.addEventListener('visibilitychange', async () => {
                        if (wakeLock !== null && document.visibilityState === 'visible') {
                            wakeLock = await navigator.wakeLock.request('screen');
                        }
                    });
                }
            } catch (err) {
                console.log('Wake Lock not supported or failed:', err);
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release()
                    .then(() => {
                        wakeLock = null;
                        console.log('Wake Lock released');
                    });
            }
        }

        function setupSwipeGestures() {
            const card = document.getElementById('workoutCard');

            const handleTouchStart = (e) => {
                touchStartX = e.changedTouches[0].screenX;
            };

            const handleTouchMove = (e) => {
                touchEndX = e.changedTouches[0].screenX;
                const diff = touchEndX - touchStartX;

                if (Math.abs(diff) > 10) {
                    card.classList.add('swiping');
                    card.style.transform = `translateX(${diff}px) rotate(${diff * 0.02}deg)`;
                }
            };

            const handleTouchEnd = () => {
                const diff = touchEndX - touchStartX;
                card.classList.remove('swiping');
                card.style.transform = '';

                if (diff > 100) {
                    // Swiped right - go to rest
                    completeSet();
                } else if (diff < -100) {
                    // Swiped left - skip rest
                    if (isResting) {
                        skipRest();
                    }
                }
            };

            // Remove existing listeners before adding new ones
            card.removeEventListener('touchstart', handleTouchStart);
            card.removeEventListener('touchmove', handleTouchMove);
            card.removeEventListener('touchend', handleTouchEnd);

            card.addEventListener('touchstart', handleTouchStart);
            card.addEventListener('touchmove', handleTouchMove);
            card.addEventListener('touchend', handleTouchEnd);
        }

        function renderWorkoutCard() {
            const card = document.getElementById('workoutCard');
            const sessionExercises = exercises[currentSession];

            if (currentExerciseIndex >= sessionExercises.length) {
                renderCompletion();
                return;
            }

            const exercise = sessionExercises[currentExerciseIndex];
            const prescription = exercise.prescription[currentWeek];
            const sets = parseInt(prescription.match(/(\d+)√ó/)?.[1] || 3);
            totalSets = sets;

            const progress = `Exercise ${currentExerciseIndex + 1}/${sessionExercises.length}`;

            if (isResting) {
                card.innerHTML = `
                    <div class="workout-header">
                        <div class="workout-progress">${progress}</div>
                        <div class="workout-title">Rest</div>
                        <div class="workout-subtitle">Recovery between sets</div>
                    </div>
                    <div class="workout-body">
                        <div class="rest-display">
                            <div class="rest-message">Great work! Take a breather</div>
                            <div class="rest-timer" id="restTimerDisplay">${formatTime(restRemaining)}</div>
                            <div class="rest-controls">
                                <button class="rest-preset" onclick="adjustRest(30)">0:30</button>
                                <button class="rest-preset" onclick="adjustRest(60)">1:00</button>
                                <button class="rest-preset" onclick="adjustRest(90)">1:30</button>
                                <button class="rest-preset" onclick="adjustRest(120)">2:00</button>
                                <button class="rest-preset" onclick="adjustRest(180)">3:00</button>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-secondary" onclick="skipRest()">Skip Rest</button>
                            </div>
                        </div>
                    </div>
                    <div class="swipe-hint">
                        ‚Üê Swipe left to skip rest
                    </div>
                `;
                startRestTimer();
            } else if (exercise.isTime) {
                // Plank/stretch with timer
                const timeInSeconds = exercise.defaultTime || parseInt(prescription.match(/(\d+)\s*sec/)?.[1] || 30);
                card.innerHTML = `
                    <div class="workout-header">
                        <div class="workout-progress">${progress} ‚Ä¢ Set ${currentSet}/${totalSets}</div>
                        <div class="workout-title">${exercise.name}</div>
                        <div class="workout-subtitle">${prescription}</div>
                    </div>
                    <div class="workout-body">
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${(currentSet / totalSets) * 100}%"></div>
                        </div>
                        <div class="plank-timer" id="plankTimerDisplay">${formatTime(timeInSeconds)}</div>
                        <div class="exercise-description">${exercise.description}</div>
                        <div class="exercise-notes">${exercise.notes}</div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="startPlankBtn" onclick="startPlankTimer(${timeInSeconds})">Start Timer</button>
                            <button class="btn btn-secondary" onclick="completeSet()" style="display: none;" id="plankCompleteBtn">Complete Set</button>
                        </div>
                    </div>
                    <div class="swipe-hint">
                        Swipe right after completing hold ‚Üí
                    </div>
                `;
            } else {
                card.innerHTML = `
                    <div class="workout-header">
                        <div class="workout-progress">${progress} ‚Ä¢ Set ${currentSet}/${totalSets}</div>
                        <div class="workout-title">${exercise.name}</div>
                        <div class="workout-subtitle">${prescription}</div>
                    </div>
                    <div class="workout-body">
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${(currentSet / totalSets) * 100}%"></div>
                        </div>
                        <div class="set-display">Set ${currentSet}</div>
                        <div class="exercise-description">${exercise.description}</div>
                        <div class="exercise-notes">${exercise.notes}</div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="completeSet()">Complete Set</button>
                        </div>
                    </div>
                    <div class="swipe-hint">
                        Swipe right to complete set ‚Üí
                    </div>
                `;
            }
        }

        function completeSet() {
            // Clear any existing timers
            if (plankTimer) clearInterval(plankTimer);

            if (currentSet < totalSets) {
                currentSet++;
                isResting = true;
                restRemaining = restTime;
                renderWorkoutCard();
            } else {
                // Move to next exercise
                currentExerciseIndex++;
                currentSet = 1;
                isResting = false;
                renderWorkoutCard();
            }
        }

        function startRestTimer() {
            if (restTimer) clearInterval(restTimer);
            shouldAutoAdvance = true; // Enable auto-advance for natural timer completion

            restTimer = setInterval(() => {
                restRemaining--;
                document.getElementById('restTimerDisplay').textContent = formatTime(restRemaining);

                if (restRemaining <= 0) {
                    playWhistle();
                    clearInterval(restTimer);
                    // Auto-advance only if it wasn't manually adjusted recently
                    if (shouldAutoAdvance) {
                        setTimeout(() => {
                            skipRest();
                        }, 1000);
                    }
                }
            }, 1000);
        }

        function startPlankTimer(duration) {
            if (plankTimer) clearInterval(plankTimer);

            plankRemaining = duration;
            document.getElementById('startPlankBtn').style.display = 'none';

            plankTimer = setInterval(() => {
                plankRemaining--;
                document.getElementById('plankTimerDisplay').textContent = formatTime(plankRemaining);

                if (plankRemaining <= 0) {
                    playWhistle();
                    clearInterval(plankTimer);
                    document.getElementById('plankCompleteBtn').style.display = 'inline-block';
                }
            }, 1000);
        }

        function skipRest() {
            if (restTimer) clearInterval(restTimer);
            isResting = false;
            renderWorkoutCard();
        }

        function adjustRest(seconds) {
            if (restTimer) clearInterval(restTimer);
            shouldAutoAdvance = false; // Disable auto-advance when manually adjusting
            restRemaining = seconds;
            restTime = seconds; // Update default
            document.getElementById('restTimerDisplay').textContent = formatTime(restRemaining);

            // Start timer that will NOT auto-advance
            restTimer = setInterval(() => {
                restRemaining--;
                document.getElementById('restTimerDisplay').textContent = formatTime(restRemaining);

                if (restRemaining <= 0) {
                    playWhistle();
                    clearInterval(restTimer);
                    // Don't auto-advance when manually adjusted
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function renderCompletion() {
            const card = document.getElementById('workoutCard');
            const sessionNames = {
                'morningActivation': 'Morning Activation',
                'bandWork': 'Hip & Glute Activation',
                'sessionA': 'Session A: Squat & Pull',
                'sessionB': 'Session B: Hinge & Lunge',
                'postRideStretching': 'Post-Ride Stretching'
            };

            card.innerHTML = `
                <div class="completion-card">
                    <div class="completion-icon">üéâ</div>
                    <div class="completion-title">Workout Complete!</div>
                    <div class="completion-message">Great job finishing ${sessionNames[currentSession]}</div>
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="endWorkout()">Done</button>
                        <button class="btn btn-secondary" onclick="restartWorkout()">Do Another</button>
                    </div>
                </div>
            `;
        }

        function endWorkout() {
            releaseWakeLock();
            if (restTimer) clearInterval(restTimer);
            if (plankTimer) clearInterval(plankTimer);
            document.getElementById('sessionSelect').style.display = 'block';
            document.getElementById('workoutView').style.display = 'none';
        }

        function restartWorkout() {
            releaseWakeLock();
            if (restTimer) clearInterval(restTimer);
            if (plankTimer) clearInterval(plankTimer);
            document.getElementById('sessionSelect').style.display = 'block';
            document.getElementById('workoutView').style.display = 'none';
        }

        function playWhistle() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();

            // Create a whistle sound (two-tone)
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // First tone
            oscillator1.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator1.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);

            // Second tone (slight harmony)
            oscillator2.frequency.setValueAtTime(1000, audioContext.currentTime);
            oscillator2.frequency.exponentialRampToValueAtTime(1400, audioContext.currentTime + 0.1);

            oscillator1.type = 'sine';
            oscillator2.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

            oscillator1.start(audioContext.currentTime);
            oscillator2.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + 0.2);
            oscillator2.stop(audioContext.currentTime + 0.2);
        }

        function renderCyclingSchedule() {
            const table = document.getElementById('cyclingTable');
            let html = `
                <thead>
                    <tr>
                        <th>Week</th>
                        <th>Mon</th>
                        <th>Tue</th>
                        <th>Wed</th>
                        <th>Thu</th>
                        <th>Fri</th>
                        <th>Sat</th>
                        <th>Sun</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
            `;

            cyclingSchedule.forEach(week => {
                html += `<tr>
                    <td><strong>Week ${week.week}</strong></td>
                    <td>${formatWorkout(week.mon)}</td>
                    <td>${formatWorkout(week.tue)}</td>
                    <td>${formatWorkout(week.wed)}</td>
                    <td>${formatWorkout(week.thu)}</td>
                    <td>${formatWorkout(week.fri)}</td>
                    <td>${formatWorkout(week.sat)}</td>
                    <td>${formatWorkout(week.sun)}</td>
                    <td><strong>${week.total}</strong></td>
                </tr>`;
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        function formatWorkout(workout) {
            if (workout === "Rest") return '<span class="workout-type type-rest">Rest</span>';
            if (workout === "Test Ride") return '<span class="workout-type type-end">Test Ride</span>';

            const type = workout.split(' ')[0].toLowerCase();
            const typeClass = `type-${type === 'thresh' ? 'thresh' : type === 'vo2' ? 'vo2' : type === 'end' ? 'end' : type === 'rec' ? 'rec' : 'act'}`;
            return `<span class="workout-type ${typeClass}">${workout}</span>`;
        }

        function renderCyclingDetails() {
            const container = document.getElementById('cyclingDetails');
            let html = '';

            for (const [title, content] of Object.entries(cyclingDetails)) {
                html += `<div class="cycling-details">`;
                html += `<h4>${title}</h4>`;

                if (typeof content === 'string') {
                    html += `<p>${content}</p>`;
                } else {
                    for (const [key, value] of Object.entries(content)) {
                        html += `<p><strong>${key}:</strong> ${value}</p>`;
                    }
                }

                html += `</div>`;
            }

            container.innerHTML = html;
        }

        function renderExerciseInfo() {
            const container = document.getElementById('exerciseInfo');
            const allExercises = [...exercises.sessionA, ...exercises.sessionB, ...exercises.bandWork];

            let html = '';
            allExercises.forEach(exercise => {
                html += `
                    <div class="info-section">
                        <h3>${exercise.name}</h3>
                        <p><strong>How to perform:</strong> ${exercise.description}</p>
                        <p><strong>Key points:</strong> ${exercise.notes}</p>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
